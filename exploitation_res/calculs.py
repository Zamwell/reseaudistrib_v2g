# -*- coding: utf-8 -*-
"""
Created on Wed Sep 25 18:49:19 2019

@author: Utilisateur
"""

import os
import pandas as pd
from matplotlib import pyplot as plt
import numpy as np

def calc_pertes(output_dir):
    table_file = os.path.join(output_dir, "res_line", "pl_mw.csv")
    df = pd.read_csv(table_file, index_col = [0], sep = ";")
    df = df/4
    df_sum = pd.DataFrame()
    df_sum['Pertes'] = df.sum(axis=1)
    return df_sum

def calc_ecart_tension(output_dir,drop=[]):
    volt_table = os.path.join(output_dir, "res_bus", "vm_pu.csv")
    drop = [str(x) for x in drop]
    df = pd.read_csv(volt_table, index_col = [0], sep = ";")
    dfi = df.drop(drop, axis = 1)
    dfi = dfi.applymap(lambda x : (0.95 - x)**2 if x < 0.95 else ((x-1.05)**2 if x > 1.05 else 0))
    ecart = dfi.to_numpy().sum()
    return ecart